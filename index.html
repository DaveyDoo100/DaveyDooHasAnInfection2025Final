<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Liquid Glass Infection Detector</title>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest"></script>

<style>
  body{
    margin:0;
    font-family:-apple-system, "SF Pro Text", sans-serif;
    background: radial-gradient(circle at 10% 10%, #291b44 0%, #090612 60%);
    color:white;
    display:flex;
    justify-content:center;
    padding:30px;
  }

  .card{
    width:100%;max-width:900px;
    border-radius:26px;
    padding:26px;
    background:rgba(255,255,255,0.05);
    border:1px solid rgba(255,255,255,0.09);
    backdrop-filter:blur(22px) saturate(160%);
  }

  .header{ display:flex; align-items:center; gap:14px; }

  .logo{
    width:52px;height:52px;border-radius:14px;
    background:linear-gradient(135deg,#7565ff,#3ba0ff);
    display:flex;align-items:center;justify-content:center;
    font-size:26px;font-weight:800;
    letter-spacing:-1px;
    box-shadow:0 10px 30px rgba(0,0,0,0.45);
  }

  h1{margin:0;font-size:22px;font-weight:700;}

  .controls{margin-top:22px;display:flex;gap:12px;flex-wrap:wrap;}
  .lg-btn{
    padding:10px 18px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,0.1);
    background:rgba(255,255,255,0.07);
    font-weight:600;
    cursor:pointer;
    backdrop-filter:blur(14px);
    transition:0.2s;
  }
  .lg-btn:hover{background:rgba(255,255,255,0.14);transform:translateY(-2px);} 

  .status-bar{margin-top:16px;display:flex;gap:20px;flex-wrap:wrap;}
  .timer{padding:6px 12px;border-radius:12px;border:1px solid rgba(255,255,255,0.06);} 

  .webcam-area{display:flex;gap:22px;margin-top:22px;flex-wrap:wrap;} 

  #webcam-container{width:420px;height:320px;border-radius:18px;overflow:hidden;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.1);
  }
  canvas{width:100%;height:100%;display:block;}

  #label-container{flex:1 1 350px;display:flex;flex-direction:column;gap:10px;}
  .label{padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,0.07);
    background:rgba(255,255,255,0.04);
    display:flex;justify-content:space-between;
  }
  .prob{color:#7ab8ff;}
</style>
</head>
<body>

<div class="card">
  <div class="header">
    <div class="logo">◇</div>
    <h1>Liquid Glass Cut Detector</h1>
  </div>

  <div class="controls">
    <button id="startBtn" class="lg-btn">Start Webcam</button>
    <button id="makeBtn" class="lg-btn">Make Prediction (3s)</button>
    <button id="stopTimerBtn" class="lg-btn">Stop Prediction Timer</button>
    <button id="resetBtn" class="lg-btn">Reset Timer</button>
  </div>

  <div class="status-bar">
    <div class="timer" id="timerBox">Timer: —</div>
    <div id="webcamStatus">Webcam: off</div>
    <div>Mode: <span id="modeText">idle</span></div>
  </div>

  <div class="webcam-area">
    <div id="webcam-container"><div style="opacity:0.6">Webcam not started</div></div>
    <div id="label-container"></div>
  </div>
</div>

<script>
const MODEL_URL = "./my_model/";
let model=null, webcam=null, raf=null;
let mode='idle';
let timer=null, timerID=null;

const modeText=document.getElementById('modeText');
const timerBox=document.getElementById('timerBox');
const webcamStatus=document.getElementById('webcamStatus');
const labelContainer=document.getElementById('label-container');
const webcamContainer=document.getElementById('webcam-container');

function setMode(m){mode=m;modeText.textContent=m;}
function setTimer(t){timerBox.textContent=t===null?"Timer: —":"Timer: "+t+"s";}
function setWebcamState(on){webcamStatus.textContent=on?"Webcam: on":"Webcam: off";}

async function loadModel(){if(!model)model=await tmImage.load(MODEL_URL+"model.json",MODEL_URL+"metadata.json");}
async function startWebcam(){
  if(!webcam){
    webcam=new tmImage.Webcam(420,320,true);
    await webcam.setup();
    await webcam.play();
    webcamContainer.innerHTML="";
    webcamContainer.appendChild(webcam.canvas);
    setWebcamState(true);
  }
  return webcam;
}

async function loop(){
  if(webcam)webcam.update();
  if(mode==='continuous'||mode==='timed')predict();
  raf=requestAnimationFrame(loop);
}

async function predict(){
  const p=await model.predict(webcam.canvas);
  labelContainer.innerHTML="";
  p.forEach(c=>{
    let d=document.createElement('div');
    d.className='label';
    d.innerHTML=`<span>${c.className}</span><span class='prob'>${(c.probability*100).toFixed(1)}%</span>`;
    labelContainer.appendChild(d);
  });
}

// START WEBCAM = continuous mode
startBtn.onclick=async()=>{
  await loadModel();
  await startWebcam();
  if(timerID)clearInterval(timerID);
  setTimer(null);
  setMode('continuous');
  if(!raf)loop();
};

// MAKE PREDICTION (3s)
makeBtn.onclick=async()=>{
  await loadModel();
  await startWebcam();

  if(timerID)clearInterval(timerID);
  timer=3; setTimer(timer);
  setMode('timed');

  if(!raf)loop();

  timerID=setInterval(()=>{
    timer--; setTimer(timer);
    if(timer<=0){
      clearInterval(timerID); timerID=null;
      setMode('idle');
      setTimer(null);
    }
  },1000);
};

// STOP TIMER = back to continuous mode
stopTimerBtn.onclick=async()=>{
  if(timerID)clearInterval(timerID);
  timer=null; setTimer(null);
  await loadModel(); await startWebcam();
  setMode('continuous');
  if(!raf)loop();
};

// RESET TIMER = restart 3s
resetBtn.onclick=async()=>{
  await loadModel(); await startWebcam();
  if(timerID)clearInterval(timerID);
  timer=3; setTimer(timer);
  setMode('timed');
  if(!raf)loop();
  timerID=setInterval(()=>{
    timer--; setTimer(timer);
    if(timer<=0){
      clearInterval(timerID); timerID=null;
      setMode('idle'); setTimer(null);
    }
  },1000);
};
</script>
</body>
</html>
